# 更新日志

## v1.1.1 (2026-01-21)

### 改进
- 🧪 **测试覆盖完善**
  - 新增 18 个测试用例，覆盖行号标记系统和 Mermaid 错误隔离功能
  - 总测试数从 67 个增加到 85 个，测试通过率 100%
  - 新增 `tests/render/markdown-line-numbers.test.js` 专门测试行号标记
  - 完善 Markdown 渲染器的行号标记测试（12 个测试用例）
  - 完善 Mermaid 错误处理测试（单个块错误隔离、XSS 防护）

### 技术更新
- 更新测试覆盖报告（`TEST_COVERAGE.md`），反映最新测试情况
- 确保所有新功能都有对应的测试用例保护

## v1.1.0 (2026-01-21)

### 新增功能
- ✨ **编辑器与预览窗格同步滚动**
  - 编辑器滚动时，预览窗格自动同步到对应位置
  - 使用行号标记系统实现精确同步
  - 流畅的滚动体验（使用 requestAnimationFrame 优化）

### 修复
- 🛠️ **修复 Mermaid 语法错误导致预览整体不显示的问题**
  - 单个 Mermaid 块渲染失败时，只在该块位置显示错误信息
  - 其他正常的 Mermaid 块和 Markdown 内容正常显示
  - 错误信息安全转义，防止 XSS
- 🛠️ **修复多次滚动后编辑器内容丢失的问题**
  - 移除错误的 `scrollMargins` API 调用
  - 加强错误处理，确保滚动计算错误不影响编辑器
  - 添加输入验证和节流机制，提升稳定性

### 改进
- ⚡ **滚动同步性能优化**
  - 使用 requestAnimationFrame 替代 setTimeout，实现流畅同步
  - 建立行号元素缓存，减少 DOM 查询开销
  - 直接设置 scrollTop，避免 scrollTo 的开销
  - 添加节流机制，限制滚动计算频率（约 60fps）

### 技术更新
- 优化滚动同步算法，提升性能和稳定性
- 加强错误处理机制，提升编辑器健壮性

## v1.0.0 (2026-01-21)

### 新增功能
- ✨ **应用状态层**（迭代 5.1）
  - 引入 `useDocument` composable 统一管理文档状态
  - 集中处理文件操作、内容更新、防抖逻辑
- ✨ **Dirty 状态追踪**（迭代 5.2）
  - 实时追踪文档修改状态
  - 保存按钮高亮显示未保存状态
  - 区分 `save()` 和 `saveAs()` 操作
- ✨ **用户体验增强**（迭代 5.4）
  - 未保存退出提示（`beforeunload` 事件）
  - 保存快捷键（Cmd/Ctrl+S）
  - 动态窗口标题（显示文件名和未保存标记）
  - 最近打开文件列表（localStorage 持久化，支持快速打开）

### 改进
- 🔒 **安全加固**（迭代 4）
  - 集成 DOMPurify 进行 HTML 消毒，防止 XSS 攻击
  - 错误信息转义处理
- 🧪 **测试覆盖**（迭代 5.3）
  - 添加 Vitest 测试框架
  - 67 个测试用例覆盖核心功能
  - 测试覆盖报告（`TEST_COVERAGE.md`）
- 🏗️ **架构优化**（迭代 1-3）
  - 抽离文件 I/O 到 `fileService`
  - 抽离渲染逻辑到 `render/markdown.js` 和 `render/mermaid.js`
  - 统一防抖策略到应用层

### 技术更新
- 添加 `dompurify` 依赖（安全防护）
- 添加测试依赖（`vitest`, `@vue/test-utils`, `jsdom`）

## v0.3 (2026-01-21)

### 修复
- 🛠️ Mermaid 渲染稳定性修复：避免 v-html 重新渲染导致的旧节点引用问题，确保 SVG 稳定插入到正确位置

### 改进
- 📄 启动默认示例文档改为从 `src/default-content.md` 加载，示例更完整且避免转义问题

## v0.2 (2026-01-21)

### 新增功能
- ✨ 集成 CodeMirror 6 编辑器，提供专业编辑体验
  - 行号显示
  - 代码折叠
  - 括号匹配
  - 自动缩进
  - Markdown 语法高亮
  - 撤销/重做功能
  - 大文件优化（防抖更新）
- ✨ VS Code Dark+ 暗色主题
  - 编辑器采用 VS Code 风格暗色主题
  - 预览窗格统一暗色风格
  - 菜单栏暗色适配
- ✨ Mermaid 流程图实时渲染
  - 修复 Mermaid 渲染问题
  - 优化图表显示大小
  - 调整字体大小和节点内边距，确保文字完整显示

### 改进
- 🎨 优化编辑器性能，支持大文件编辑
- 🎨 改进 Mermaid 图表渲染，确保文字完整显示
- 🎨 统一界面风格，采用 VS Code 暗色主题

### 技术更新
- 添加 CodeMirror 6 相关依赖
- 更新 Mermaid 配置，优化渲染效果
- 改进错误处理和回退机制

## v0.1 (2026-01-20)

### 初始版本
- ✅ 基础 Markdown 编辑器
- ✅ 分窗编辑和预览
- ✅ Mermaid 流程图支持
- ✅ 文件打开和保存功能
- ✅ 基础语法高亮
